{
  "name": "Grub2-pvinstall",
  "tagline": "Contains code to install GRUB2 into an LVM PV",
  "body": "= Grub2 LVM PV install =\r\n\r\nThis fork contains the code to install GRUB2 directly on a LVM \"physical volume\".\r\n\r\nThe main branch (master) is just the same as upstream branch master. The branch \"pvinstall\" contains the changes and is rebased on top of local master by rebasing the first meaningful commit and all that follow on top of it.\r\n\r\n== Building ==\r\n\r\nI am not going to include build instructions here now. I don't remember what packages I exactly installed (on Ubuntu) but they are not many, you don't need *everything* to build a basic GRUB. However, I did notice that <code>update-grub</code> was not compiled, for now you can just use the update-grub that comes with your distribution and only use <code>grub-install</code> from this one; by default it will install into /usr/local/.\r\n\r\nThis is not using any Ubuntu build instructions. The complete set can be installed using:\r\n\r\n apt build-dep grub2 \r\n\r\nAs of writing (2016-07-28) Ubuntu (16.04) still comes with a version (2.02beta2) that is at least as old as May, 2015. That means the source for Ubuntu is older than a year. The current patch should apply cleanly to Ubuntu sources though.\r\n\r\nTo obtain a patch, you can create a diff agains the current HEAD of master.\r\n\r\n=== Patch of all the changes I've done ===\r\n\r\n git diff master pvinstall\r\n\r\nBut this will include any irrelevant house-keeping changes. Not that it matters.\r\n\r\nA diff with only the most essential set of changes for the patch would have to be done against the last \"housekeeping\" commit from pvinstall. I just keep them in one branch although I could put the housekeeping changes in its own branch or just apply them to master. For now, I think this is cleaner.\r\n\r\n== Obtaining ==\r\n\r\n git clone https://github.com/drydenp/grub2-pvinstall.git\r\n\r\nshould fetch this repo and set up the remote origin\r\n\r\n git remote add upstream git://git.savannah.gnu.org/grub.git\r\n\r\nshould add the ref to upstream\r\n\r\n== Maintenance ==\r\n\r\n=== Updating local master ===\r\n\r\n git fetch upstream\r\n git checkout master\r\n git merge upstream/master\r\n\r\n=== Rebasing changes on top of local master ===\r\n\r\n git checkout pvinstall\r\n git rebase master\r\n\r\n=== Updating the Ubuntu branch ===\r\n\r\nJust assuming the Ubuntu sources will not change...\r\n\r\n git checkout pvinstall_ubuntu2.02beta2\r\n # the last commit unique to the Ubuntu tree is tagged ubuntu_ignore\r\n\r\n # reset previously cherry-picked commits:\r\n git reset --hard ubuntu_ignore \r\n\r\n # copy new commits over\r\n git cherry-pick master..pvinstall\r\n\r\nAlternatively the commit that change the .ignore file is:\r\n\r\n git log --oneline .gitignore | head -1 | sed \"s/ .*//\"\r\n git log --online | grep \"\\bIgnore$\" | sed \"s/ .*//\"\r\n\r\n=== Replacing the Ubuntu sources ===\r\n\r\nYou could do this by hand, but this works perfectly most of the time.\r\n\r\nThe only time when it didn't was when a Vim .readme.wiki.swp had mysteriously made its way into the first commit ;-). That file, just as all files, should get removed with <code>git rm -rf .</code>. Rerunning the code wiped it and all was fine again. '''The complete sources of Ubuntu are stored prior to storing the .gitignore.''' I don't know what the point of that is, but that's the way it goes now. Below code leaves the branch empty of any new changes (my own commits). \r\n\r\n tmp=$( mktemp -d ) && { \r\n   cd $tmp && apt source grub2 && {\r\n     subdir=$( ls -d * --file-type | grep \"/$\" | sed 's@/$@@' ) &&\r\n     version=$( echo \"$subdir\" | sed \"s/grub2-//\" | tr -d '~' ) && \r\n     cd - && git checkout --orphan pvinstall_ubuntu${version}_temp && { \r\n       git rm -rf --ignore-unmatch . && mv $tmp/$subdir/* . &&\r\n       git add . && git commit -m \"Ubuntu sources $version\" &&\r\n       git cherry-pick ubuntu_ignore &&\r\n       git branch -M pvinstall_ubuntu${version}_temp pvinstall_ubuntu${version} ||\r\n       git branch -D pvinstall_ubuntu${version}_temp\r\n     }  \r\n     rm -rf $tmp/*\r\n   }\r\n   rmdir $tmp\r\n }\r\n\r\n\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}